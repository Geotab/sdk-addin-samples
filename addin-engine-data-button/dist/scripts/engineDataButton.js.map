{"version":3,"sources":["engineDataButton.js"],"names":["geotab","customButtons","engineDataButton","event","api","state","noVehiclesText","mutipleVehiclesText","preventDefault","diagnostics","device","pageState","getState","id","length","isMultipleDevices","Array","isArray","dateRange","date","Date","interval","endDate","getTime","startDate","toISOString","messenger","timer","mainContainer","textContainer","closeIcon","addAttributes","element","attrs","a","hasOwnProperty","setAttribute","addCss","styles","style","createElement","elemName","css","appendTo","elem","document","appendChild","destroy","clearInterval","undefined","removeEventListener","parentNode","removeChild","getMainContent","querySelector","createMainContent","body","innerHTML","addEventListener","showMessage","warningText","setInterval","textContent","gotoPage","diagnostic"],"mappings":"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","sourcesContent":["/**\r\n * The function is called whenever the Add-In button is clicked.\r\n *\r\n * @param {object} event - The event dispatched from the button click.\r\n * @param {object} api - The GeotabApi object for making calls to MyGeotab.\r\n * @param {object} state - The page state object allows access to URL, page navigation and global group filter.\r\n */\r\ngeotab.customButtons.engineDataButton = (event, api, state) => {\r\n  'use strict';\r\n\r\n  const noVehiclesText = 'Select any vehicle first';\r\n  const mutipleVehiclesText = 'Graph cannot be opened for multiple devices';\r\n\r\n  event.preventDefault();\r\n\r\n  // The diagnostic ids to display the data of\r\n  let diagnostics = [\r\n    'DiagnosticEngineSpeedId',\r\n    'DiagnosticGoDeviceVoltageId',\r\n    'DiagnosticDeviceTotalFuelId'\r\n  ];\r\n\r\n  // The currently selected device from state\r\n  let device = (() => {\r\n    let pageState = state.getState();\r\n    return (pageState && pageState.id && pageState.id.length) ? pageState.id : null;\r\n  })();\r\n\r\n  let isMultipleDevices = device !== null && Array.isArray(device);\r\n\r\n  // The date range which will be used on engine data profile\r\n  let dateRange = (() => {\r\n    let date = new Date(),\r\n      interval = 60 * 60 * 24 * 1000,   // a day\r\n      endDate = new Date(date.getTime() - interval);\r\n    return {\r\n      startDate: endDate.toISOString(),\r\n      endDate: date.toISOString()\r\n    };\r\n  })();\r\n\r\n  // Displays messages to the UI\r\n  let messenger = (() => {\r\n\r\n    let timer;\r\n    let mainContainer;\r\n    let textContainer;\r\n    let closeIcon;\r\n\r\n    let addAttributes = function (element, attrs) {\r\n      for (let a in attrs) {\r\n        if (attrs.hasOwnProperty(a)) {\r\n          element.setAttribute(a, attrs[a]);\r\n        }\r\n      }\r\n    };\r\n\r\n    let addCss = function (element, styles) {\r\n      for (let a in styles) {\r\n        if (styles.hasOwnProperty(a)) {\r\n          element.style[a] = styles[a];\r\n        }\r\n      }\r\n    };\r\n\r\n    let createElement = function (elemName, attrs, css, appendTo) {\r\n      let elem = document.createElement(elemName);\r\n\r\n      if (attrs) {\r\n        addAttributes(elem, attrs);\r\n      }\r\n\r\n      if (css) {\r\n        addCss(elem, css);\r\n      }\r\n\r\n      if (appendTo) {\r\n        appendTo.appendChild(elem);\r\n      }\r\n\r\n      return elem;\r\n    };\r\n\r\n    let destroy = () => {\r\n      if (timer) {\r\n        clearInterval(timer);\r\n        timer = undefined;\r\n      }\r\n\r\n      if (closeIcon) {\r\n        closeIcon.removeEventListener('click', destroy, false);\r\n      }\r\n\r\n      if (mainContainer && mainContainer.parentNode) {\r\n        mainContainer.parentNode.removeChild(mainContainer);\r\n      }\r\n\r\n      mainContainer = undefined;\r\n      textContainer = undefined;\r\n      closeIcon = undefined;\r\n    };\r\n\r\n    let getMainContent = () => {\r\n      return document.querySelector('#engineDataButton-addin');\r\n    };\r\n\r\n    let createMainContent = () => {\r\n      mainContainer = createElement('div', {\r\n        id: 'engineDataButton-addin'\r\n      }, {\r\n          'border': '1px solid #ffeb94',\r\n          'background-color': '#fffcdd',\r\n          'color': '#222',\r\n          'margin': '0 auto 0 auto',\r\n          'position': 'relative',\r\n          'width': '600px',\r\n          'top': 0,\r\n          'right': '0',\r\n          'z-index': '10004',\r\n          'table-layout': 'fixed',\r\n          'opacity': 0.9,\r\n          'text-align': 'center'\r\n        }, document.body);\r\n\r\n      mainContainer.destroy = destroy;\r\n\r\n      textContainer = createElement('h2', null, {\r\n        'display': 'inline-block',\r\n        'margin': '5px 0',\r\n        'word-wrap': 'break-word',\r\n        'font-weight': 'normal',\r\n        'font-size': '1.5em',\r\n        'color': '#222',\r\n        'text-align': 'center'\r\n      }, mainContainer);\r\n\r\n      closeIcon = createElement('span', null, {\r\n        'float': 'right',\r\n        'margin-top': '9px',\r\n        'font-size': '20px',\r\n        'width': '30px',\r\n        'position': 'relative',\r\n        'top': '-0.1em',\r\n        'left': '-0.1em',\r\n        'font-family': 'arial',\r\n        'font-style': 'normal',\r\n        'font-weight': 'bold',\r\n        'cursor': 'pointer',\r\n        'display': 'inline-block',\r\n        'text-decoration': 'none',\r\n        'text-align': 'center',\r\n        'vertical-align': 'middle',\r\n        'overflow': 'hidden',\r\n        'font-variant': 'normal',\r\n        'text-transform': 'none',\r\n        'color': '#222'\r\n      }, mainContainer);\r\n\r\n      closeIcon.innerHTML = 'x';\r\n      closeIcon.addEventListener('click', destroy, false);\r\n    };\r\n\r\n    return {\r\n      /**\r\n       * Shows a message to the UI\r\n       */\r\n      showMessage: (warningText) => {\r\n        mainContainer = getMainContent();\r\n        if (!mainContainer) {\r\n          createMainContent();\r\n          timer = setInterval(destroy, 5000);\r\n        }\r\n        textContainer.textContent = warningText;\r\n      },\r\n      /**\r\n       * Destorys the current message\r\n       */\r\n      destroy: () => {\r\n        mainContainer = mainContainer || getMainContent();\r\n        if (mainContainer) {\r\n          mainContainer.destroy();\r\n        }\r\n      }\r\n    };\r\n  })();\r\n\r\n  if (device && device !== 'all' && !isMultipleDevices) {\r\n    messenger.destroy();\r\n\r\n    // redirect to the engine data profile page passing in arguments for device, date range and diagnostics to display\r\n    state.gotoPage('engineDataProfile', {\r\n      dateRange: dateRange,\r\n      device: [device],\r\n      diagnostic: diagnostics\r\n    });\r\n  } else {\r\n    messenger.showMessage(isMultipleDevices ? mutipleVehiclesText : noVehiclesText);\r\n  }\r\n};\r\n"],"file":"engineDataButton.js"}